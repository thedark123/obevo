<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2020-01-09 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200109" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Obevo &#x2013; Considerations on Users Applying Versions to their Deploymennts</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/goldmansachs/obevo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Intro">Intro</a></li>
            <li><a href="overview.html" title="Overview">Overview</a></li>
            <li><a href="setup.html" title="Setup">Setup</a></li>
            <li><a href="support.html" title="Help and Support">Help and Support</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a></li>
            <li><a href="environment-management.html" title="Environment Management">Environment Management</a></li>
            <li><a href="permission-management.html" title="Permission Management">Permission Management</a></li>
            <li><a href="error-handling.html" title="Error-Handling">Error-Handling</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="command-line-api.html" title="Command-line API">Command-line API</a></li>
            <li><a href="java-api.html" title="Java API">Java API</a></li>
            <li><a href="maven-api.html" title="Maven plugin API">Maven plugin API</a></li>
            <li><a href="gradle-api.html" title="Gradle API">Gradle API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced Topics <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a></li>
            <li><a href="rollback.html" title="Rollback">Rollback</a></li>
            <li><a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a></li>
            <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging">Separate Schema and Config Packaging</a></li>
            <li><a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a></li>
            <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a></li>
            <li><a href="orm-integration.html" title="ORM Integration">ORM Integration</a></li>
            <li><a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a></li>
            <li><a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a></li>
            <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Platform-Specific Details <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="platform-listing.html" title="Platform Listing">Platform Listing</a></li>
            <li><a href="db2-notes.html" title="DB2">DB2</a></li>
            <li><a href="general-db-notes.html" title="HSQLDB">HSQLDB</a></li>
            <li><a href="general-db-notes.html" title="H2">H2</a></li>
            <li><a href="mongodb-notes.html" title="MongoDB">MongoDB</a></li>
            <li><a href="oracle-notes.html" title="Oracle">Oracle</a></li>
            <li><a href="postgresql-notes.html" title="PostgreSQL">PostgreSQL</a></li>
            <li><a href="redshift-notes.html" title="Redshift">Redshift</a></li>
            <li><a href="sybase-ase-notes.html" title="SQL Server">SQL Server</a></li>
            <li><a href="sybase-ase-notes.html" title="Sybase ASE">Sybase ASE</a></li>
            <li><a href="general-db-notes.html" title="Sybase IQ">Sybase IQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Onboarding Guide <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a></li>
            <li><a href="new-onboarding-guide.html" title="New Systems">New Systems</a></li>
            <li><a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a></li>
            <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a></li>
            <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a></li>
            <li><a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
              <ul class="dropdown-menu">
                  <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup">Docker-based Test DB Setup</a></li>
                  <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup">Amazon RDS DB Setup</a></li>
                  <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup">Sybase ASE Test DB Setup</a></li>
              </ul>
            </li>
            <li><a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="./" id="bannerLeft"><h2>Obevo</h2>
</a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li class=""><a href="./" title="Obevo">Obevo</a><span class="divider">/</span></li>
    <li class="active ">Considerations on Users Applying Versions to their Deploymennts</li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2020-01-09</li>
          <li id="projectVersion" class="pull-right">Version: 8.0.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Getting Started</li>
    <li><a href="index.html" title="Intro"><span class="none"></span>Intro</a>  </li>
    <li><a href="overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="setup.html" title="Setup"><span class="none"></span>Setup</a>  </li>
    <li><a href="support.html" title="Help and Support"><span class="none"></span>Help and Support</a>  </li>
          <li class="nav-header">Technical Documentation</li>
    <li><a href="db-project-structure.html" title="DB Project Structure"><span class="none"></span>DB Project Structure</a>  </li>
    <li><a href="environment-management.html" title="Environment Management"><span class="none"></span>Environment Management</a>  </li>
    <li><a href="permission-management.html" title="Permission Management"><span class="none"></span>Permission Management</a>  </li>
    <li><a href="error-handling.html" title="Error-Handling"><span class="none"></span>Error-Handling</a>  </li>
          <li class="nav-header">API Documentation</li>
    <li><a href="command-line-api.html" title="Command-line API"><span class="none"></span>Command-line API</a>  </li>
    <li><a href="java-api.html" title="Java API"><span class="none"></span>Java API</a>  </li>
    <li><a href="maven-api.html" title="Maven plugin API"><span class="none"></span>Maven plugin API</a>  </li>
    <li><a href="gradle-api.html" title="Gradle API"><span class="none"></span>Gradle API</a>  </li>
          <li class="nav-header">Advanced Topics</li>
    <li><a href="db-project-best-practices.html" title="DB Project Best Practices"><span class="none"></span>DB Project Best Practices</a>  </li>
    <li><a href="rollback.html" title="Rollback"><span class="none"></span>Rollback</a>  </li>
    <li><a href="multiple-schema-management.html" title="Multiple Schema Management"><span class="none"></span>Multiple Schema Management</a>  </li>
    <li><a href="schema-and-config-packaging.html" title="Separate Schema and Config Packaging"><span class="none"></span>Separate Schema and Config Packaging</a>  </li>
    <li><a href="in-memory-db-testing.html" title="In-memory DB Testing"><span class="none"></span>In-memory DB Testing</a>  </li>
    <li><a href="parallel-deploy-execution.html" title="Parallel Deploy Execution"><span class="none"></span>Parallel Deploy Execution</a>  </li>
    <li><a href="orm-integration.html" title="ORM Integration"><span class="none"></span>ORM Integration</a>  </li>
    <li><a href="baseline-validation.html" title="Baseline DDL Validation"><span class="none"></span>Baseline DDL Validation</a>  </li>
    <li><a href="phased-deployments.html" title="Phased Deployments"><span class="none"></span>Phased Deployments</a>  </li>
    <li><a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup"><span class="none"></span>Incremental Change Code Cleanup</a>  </li>
          <li class="nav-header">Platform-Specific Details</li>
    <li><a href="platform-listing.html" title="Platform Listing"><span class="none"></span>Platform Listing</a>  </li>
    <li><a href="db2-notes.html" title="DB2"><span class="none"></span>DB2</a>  </li>
    <li><a href="general-db-notes.html" title="HSQLDB"><span class="none"></span>HSQLDB</a>  </li>
    <li><a href="general-db-notes.html" title="H2"><span class="none"></span>H2</a>  </li>
    <li><a href="mongodb-notes.html" title="MongoDB"><span class="none"></span>MongoDB</a>  </li>
    <li><a href="oracle-notes.html" title="Oracle"><span class="none"></span>Oracle</a>  </li>
    <li><a href="postgresql-notes.html" title="PostgreSQL"><span class="none"></span>PostgreSQL</a>  </li>
    <li><a href="redshift-notes.html" title="Redshift"><span class="none"></span>Redshift</a>  </li>
    <li><a href="sybase-ase-notes.html" title="SQL Server"><span class="none"></span>SQL Server</a>  </li>
    <li><a href="sybase-ase-notes.html" title="Sybase ASE"><span class="none"></span>Sybase ASE</a>  </li>
    <li><a href="general-db-notes.html" title="Sybase IQ"><span class="none"></span>Sybase IQ</a>  </li>
          <li class="nav-header">Onboarding Guide</li>
    <li><a href="onboarding-guide.html" title="Which onboarding to choose?"><span class="none"></span>Which onboarding to choose?</a>  </li>
    <li><a href="new-onboarding-guide.html" title="New Systems"><span class="none"></span>New Systems</a>  </li>
    <li><a href="existing-onboarding-guide.html" title="Existing Systems"><span class="none"></span>Existing Systems</a>  </li>
    <li><a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards"><span class="none"></span>Existing Systems with Diverging Shards</a>  </li>
    <li><a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems"><span class="none"></span>Legacy Onboarding - Legacy Systems</a>  </li>
    <li><a href="db-merge-tool.html" title="DB Merge Tool"><span class="none"></span>DB Merge Tool</a>  </li>
          <li class="nav-header">Developer Information</li>
    <li><a href="developer-guide.html" title="Developer Guide"><span class="icon-chevron-down"></span>Developer Guide</a>
      <ul class="nav nav-list">
    <li><a href="dev-setup-docker.html" title="Docker-based Test DB Setup"><span class="none"></span>Docker-based Test DB Setup</a>  </li>
    <li><a href="dev-setup-amazon.html" title="Amazon RDS DB Setup"><span class="none"></span>Amazon RDS DB Setup</a>  </li>
    <li><a href="dev-setup-sybase-ase.html" title="Sybase ASE Test DB Setup"><span class="none"></span>Sybase ASE Test DB Setup</a>  </li>
      </ul>
  </li>
    <li><a href="design-walkthrough.html" title="Design Walkthrough"><span class="none"></span>Design Walkthrough</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--

    Copyright 2017 Goldman Sachs.
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

--><h1>Considerations on Users Applying Versions to their Deploymennts</h1>
<p>Obevo&#x2019;s deployment algorithm (described in detail <a class="externalLink" href="https://github.com/goldmansachs/obevo/blob/master/Obevo_Javasig.pdf">here</a> does not require users to consider their code bases using application versions (e.g. tagging a binary using a semantic versioning scheme like X.Y.Z, and determining deploy actions based on that). The algorithm is agnostic to that; Obevo simply looks at a codebase (consisting of incremental and rerunnable changes) to deploy, and calculates the migration to perform based on the difference of what is in the deploy log. It does not matter where the code base comes from, whether from a versioned package or unnamed archive or files on the file system.</p>
<p>However, users do have the option to associate their own version numbers on packages deployed via Obevo, and Obevo has some features that are enabled when this is used. This page will go into more depth on this.</p>
<div class="section">
<h2><a name="Brief_Review_of_Deploy_Algorithm"></a>Brief Review of Deploy Algorithm</h2>
<p>Obevo works by tracking deployed <i>changes</i> as a deploy logic, and only incrementally deploying deltas to the target environment.</p>
<p>For example:</p>
<p>Deploy V1: * Environment Audit Log shows no changes deployed * Source Codebase has three changes (INC1, RR2, RR3) * Obevo calculates the changeset difference as (INC1, RR2, RR3) and thus attempts to deploy each of those * Upon successful deployment of an individual change, it is recorded to the Environment Audit Log</p>
<p>Deploy V2: * Environment Audit Log shows three changes (INC1, RR2, RR3) deployed * Source Codebase has three changes (INC1, RR2&#x2018;, INC4), with RR2&#x2019; modified from the original RR2 * To summarize the changeset:  * INC1 remains unchanged, and so that is not included in the changeset  * RR2&#x2019; is modified, and so it is included in the changeset  * RR3 is removed, and so it is added to the changeset as a deletion  * INC4 is added, and so it is added to the changeset as a deletion</p>
<p>How adds/drops/modifications are handled depends on the object type: * Incremental changes (i.e. for tables) do not allow modifications and removals of deployments, except for rebaseline use cases * Rerunnable objects, in contrast, can be modified and dropped * Both use cases support simple additions</p>
<p>In the example above, the incremental changs are named with the &#x201c;INC&#x201d; prefix, likewise fo rerunnable changes and the &#x201c;RR&#x201d; prefix. We will use this example for the following sections.</p></div>
<div class="section">
<h2><a name="Implications_on_rollback"></a>Implications on rollback</h2>
<div class="section">
<h3><a name="Situation_without_application_versioning"></a>Situation without application versioning</h3>
<p>For regular deployments, note that only <i>additions</i> of incremental changes are allowed, not removals. Thus, for typical releases, new incremental changes tend to be added (e.g. Deploy V1 to Deploy V2)</p>
<p>However, consider if a rollback situation arises (e.g. needing to re-deploy V1 after having deployed V2). In that case, the deployment would appear as follows:</p>
<p>Re-Deploy V1 from V2: * Environment Audit Log shows three changes (INC1, RR2&#x2018;, INC4) deployed * Source Codebase has three changes (INC1, RR2, RR3), with RR2 modified from the original RR2&#x2019; * To summarize the changeset:  * INC1 remains unchanged, and so that is not included in the changeset  * RR2&#x2019; is modified, and so it is included in the changeset  * RR3 is added, and so it is added to the changeset  * INC4 is removed &#x2026;</p>
<p>Note that the INC4 change now appears as a deletion. Normally, this change would not be allowed as this is an incremental change. In Obevo, users can signal that a deployment is intended as a rollback using the -rollback option (see the <a href="rollback.md">Rollback Documentation</a> for more details).</p>
<p>However, users may not always have the flexibility to change the deploy command to include -rollback based on the kind of deployment tooling they have. We now detail &#x2026;</p></div>
<div class="section">
<h3><a name="How_Obevos_application_versioning_functionality_can_help"></a>How Obevo&#x2019;s application versioning functionality can help</h3>
<p>In the example above, from a human perspective, it seems obvious that V2 is a later version than V1, and that going from V2 to V1 should be a rollback. How can we tell Obevo to do this?</p>
<p>1) Specify the -productVersion &lt;versionName&gt; attribute in your deploy call to have the version number stored</p>

<div class="source">
<div class="source"><pre class="prettyprint">deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.2.3
</pre></div></div>
<p>This is an optional parameter that will store the version value as a new field in the DEPLOYEXECUTION audit table.</p>
<p>2) Using this field, Obevo will know that a version deployment is a rollback if:</p>

<ul>
  
<li>A) The version deployed had previously been deployed</li>
  
<li>B) There was another version deployed since the original version</li>
</ul>
<p>For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.0.0  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.0.0  # considered a regular forward deploy (no-op in this case)
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 2.0.0  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.0.0  # rollback deploy
</pre></div></div>
<p>How does Obevo do this? By simply checking for the existence of the productVersion in the DEPLOYEXECUTION table.</p>
<p>Note that the actual version naming scheme does not matter; the check is based purely on the values of the DEPLOYEXECUTION table.</p>
<p>For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">deploy.sh DEPLOY -sourcePath /my/source/path -productVersion myVersionA  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion myVersionB  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion myVersionA  # rollback deploy
</pre></div></div>
<p>Given that, note that this requires deploying a previously-named version as is. As it stands today, Obevo will not understand semantic versioning and will not automatically consider the deployment as a rollback.</p>

<div class="source">
<div class="source"><pre class="prettyprint">deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.0.0  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 2.0.0  # considered a regular forward deploy
deploy.sh DEPLOY -sourcePath /my/source/path -productVersion 1.1.0  # considered a regular forward deploy (even though version number is lower)
</pre></div></div>
<p>(It would be possible to have Obevo consider semantic versioning for rollbacks. This would have to be an opt-in argument for users. It would not be a large build, but needs prioritization. Please raise a Github issue to inquire more)</p></div>
<div class="section">
<h3><a name="Handling_Branch_Releases"></a>Handling Branch Releases</h3>
<p>Work in progress</p>
<p>Starting use case: * you deploy v1.0.0 with changes A1, B1, C1 * then you are working on v2.0.0 in development, say with changes A1, B1, C1, D1, E1 in total</p>
<p>Now say we need to release a fix in production, say to add a change A2 * you deploy v1.0.0 with changes A1, B1, C1, A2</p>
<p>What happens the next time you deploy v2.0.0 on that database?</p>
<p>If you have not incorporated A2 into your v2.0.0 branch, then the next deploy of v2.0.0 will attempt to remove A2, which may not be correct. Hence, any time you do a release off the non-master branch, please ensure that all merges on the release branch are merged into the master branch.</p>
<p>For example: * In v2.0.0, add A2, such as: A1, B1, C2, A2, D1, E1</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2020
<a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
